name: üìö Build EFC Master ‚Äî PDF + HTML

on:
  push:
    branches:
      - main
    paths:
      - 'theory/**'
      - 'docs/**'
      - 'output/**'
      - '.github/workflows/build_efc_master_dual.yml'

jobs:

  build-master:
    runs-on: ubuntu-latest

    steps:

    - name: Checkout repository
      uses: actions/checkout@v4

    # Cache LaTeX packages for faster builds
    - name: Cache LaTeX
      uses: actions/cache@v3
      with:
        path: /tmp/texlive
        key: texlive-cache

    - name: Install TeX Live (full)
      run: |
        sudo apt-get update
        sudo apt-get install -y texlive-full pandoc

    - name: Build EFC Master PDF
      working-directory: ./theory
      run: |
        latexmk -pdf -interaction=nonstopmode efc_master.tex || true

    - name: Check for PDF output
      run: |
        if [ ! -f theory/efc_master.pdf ]; then
          echo "‚ùå Build failed: efc_master.pdf not found"
          exit 1
        fi

    - name: Build HTML via Pandoc
      working-directory: ./theory
      run: |
        pandoc efc_master.tex -s -o efc_master.html || true

    - name: Check for HTML output
      run: |
        if [ ! -f theory/efc_master.html ]; then
          echo "‚ö†Ô∏è HTML build missing ‚Äî continuing without stopping..."
        fi

    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: efc_master_build
        path: |
          theory/efc_master.pdf
          theory/efc_master.html
