<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EFC Workflow Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      max-width: 900px;
      margin: 2rem auto;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.5;
    }
    h1, h2, h3 {
      margin-top: 1.6rem;
    }
    code, pre {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    pre {
      background: #f5f5f5;
      padding: 1rem;
      overflow-x: auto;
      border-radius: 6px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin: 1rem 0;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    ul {
      margin-left: 1.2rem;
    }
  </style>
</head>
<body>

<h1>ðŸ”§ EFC Workflow Map</h1>
<p>Automated CI/CD and Semantic Synchronization</p>

<p>
This document describes how the EFC repository keeps itself up to date.
It shows how data flows through the system, how automation is wired,
and how semantic nodes stay aligned across Figshare, GitHub Actions,
the API layer and the dashboard.
</p>

<h2>1. Overview</h2>
<p>The system maintains and updates:</p>
<ul>
  <li><strong>Semantics</strong> (<code>schema/*</code>)</li>
  <li><strong>Metadata</strong> (Figshare â†’ GitHub)</li>
  <li><strong>Validation</strong> (JWST, DESI, SPARC)</li>
  <li><strong>API endpoints</strong> (<code>api/v1/</code>)</li>
  <li><strong>Dashboard</strong> (<code>docs/dashboard/</code> or similar)</li>
  <li><strong>Documentation</strong> (README + project files)</li>
  <li><strong>Reflection</strong> (<code>reflection/</code>)</li>
</ul>
<p>Each workflow is a module. Together they form a self-correcting system.</p>

<h2>2. Workflow Dependency Graph</h2>
<pre><code class="language-mermaid">
flowchart TD

%% Fetch
F1[fetch-figshare.yml&lt;br&gt;Fetch DOI metadata]

%% Schema Merge
SC1[update-concepts.yml&lt;br&gt;Update schema/]
F1 --&gt; SC1

%% API
API1[update-api.yml&lt;br&gt;Regenerate api/v1/]
SC1 --&gt; API1

%% Dashboard
DB1[build-dashboard.yml&lt;br&gt;Update dashboard]
API1 --&gt; DB1

%% Validation
VAL[run-validation.yml&lt;br&gt;JWST / DESI / SPARC]
VAL --&gt; OUT[output/&lt;br&gt;plots + metrics]

%% Export
OUT --&gt; FS[export_figshare.yml&lt;br&gt;Upload to Figshare]

%% Orchestrator
META[update_efc_system.yml&lt;br&gt;Daily full cycle]
META --&gt; F1
META --&gt; SC1
META --&gt; API1
META --&gt; DB1
</code></pre>

<h2>3. Workflow Functions</h2>
<table>
  <thead>
    <tr>
      <th>Workflow</th>
      <th>Purpose</th>
      <th>Trigger</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>fetch-figshare.yml</code></td>
      <td>Fetch DOI metadata â†’ <code>/figshare/</code></td>
      <td>Manual / Meta</td>
    </tr>
    <tr>
      <td><code>update-concepts.yml</code></td>
      <td>Update <code>concepts.json</code> and <code>site-graph.json</code></td>
      <td>After Figshare fetch</td>
    </tr>
    <tr>
      <td><code>update-api.yml</code></td>
      <td>Regenerate <code>api/v1/</code> JSON-LD endpoints</td>
      <td>On schema changes</td>
    </tr>
    <tr>
      <td><code>build-dashboard.yml</code></td>
      <td>Rebuild dashboard views</td>
      <td>On API or data updates</td>
    </tr>
    <tr>
      <td><code>run-validation.yml</code></td>
      <td>JWST / DESI / SPARC validation</td>
      <td>On every push to <code>main</code></td>
    </tr>
    <tr>
      <td><code>export_figshare.yml</code></td>
      <td>Upload new plots and data to Figshare</td>
      <td>When <code>/output/</code> changes</td>
    </tr>
    <tr>
      <td><code>update-readme-date.yml</code></td>
      <td>Refresh timestamp in README</td>
      <td>Daily</td>
    </tr>
    <tr>
      <td><code>update-schema.yml</code></td>
      <td>Validate schema and regenerate schema maps</td>
      <td>On <code>/schema/</code> changes</td>
    </tr>
    <tr>
      <td><code>update_efc_system.yml</code></td>
      <td>Full orchestrated sync cycle</td>
      <td>Daily 02:00 UTC</td>
    </tr>
  </tbody>
</table>

<h2>4. The Semantic Loop</h2>
<p>The core loop:</p>

<h3>1. Fetch</h3>
<ul>
  <li>Pull the latest DOI metadata from Figshare.</li>
  <li>Write JSON summaries under <code>/figshare/</code>.</li>
</ul>

<h3>2. Merge</h3>
<ul>
  <li>Update <code>schema/concepts.json</code>.</li>
  <li>Update <code>schema/site-graph.json</code>.</li>
</ul>

<h3>3. API Regeneration</h3>
<ul>
  <li>Regenerate <code>/api/v1/</code> (index + one JSON-LD file per concept).</li>
  <li>Provide a stable machine-readable API for the website, dashboard and external tools.</li>
</ul>

<h3>4. Dashboard Update</h3>
<ul>
  <li>Read API outputs and validation results.</li>
  <li>Build updated charts, status views and indicators.</li>
</ul>

<h3>5. Reflection Layer</h3>
<ul>
  <li>Write system status and meta-signals to <code>/reflection/</code>.</li>
  <li>Track semantic coherence, resonance and cross-links.</li>
</ul>

<p>The loop halts if validation or import tests fail.</p>

<h2>5. Validation Pipeline</h2>
<p>The validation pipeline covers three dataset families:</p>
<ul>
  <li>JWST early galaxies</li>
  <li>DESI expansion curve / BAO</li>
  <li>SPARC rotation curves</li>
</ul>
<p>For each dataset, the pipeline:</p>
<ul>
  <li>imports <code>src/efc/*</code> modules</li>
  <li>runs EFC computations</li>
  <li>writes figures and metrics into <code>output/validation/</code></li>
  <li>runs <code>scripts/check_imports.py</code> as a gate</li>
</ul>

<h2>6. Import Test Suite</h2>
<p><code>scripts/check_imports.py</code> ensures that:</p>
<ul>
  <li>all submodules under <code>src/efc/</code> import without errors</li>
  <li>no circular imports are introduced</li>
  <li>the public API remains stable across refactors</li>
  <li>validation and API generation use the same core model code</li>
</ul>
<p>It acts as a safety gate before heavier workflows run.</p>

<h2>7. External Integration</h2>
<p>Four main external anchors:</p>
<ul>
  <li><strong>GitHub</strong> â€” code, workflows, API snapshots</li>
  <li><strong>Figshare</strong> â€” DOIs, archived outputs</li>
  <li><strong>ORCID</strong> â€” authorship and provenance</li>
  <li><strong>energyflow-cosmology.com</strong> â€” public site and dashboard</li>
</ul>
<p>Typical flow:</p>
<ul>
  <li>Code and schemas live in the repository.</li>
  <li>Outputs and figures are exported to Figshare and assigned DOIs.</li>
  <li>The website reads structured data from <code>/schema/</code> and <code>/api/v1/</code>, and from Figshare endpoints.</li>
  <li>ORCID ties everything to the author identity.</li>
</ul>

<h2>8. Purpose of the Workflow Layer</h2>
<ul>
  <li>Reproducible open science</li>
  <li>Continuously updated metadata and concepts</li>
  <li>Automatic testing of cosmological predictions</li>
  <li>Stable machine-readable API for search and AI systems</li>
  <li>Transparent provenance via ORCID and DOIs</li>
  <li>Consistent semantics across all platforms</li>
</ul>
<p>
The workflow layer makes the repository behave like a thermodynamic knowledge graph:
it updates, stabilizes and corrects itself over time.
</p>

<h2>9. Architecture Diagram</h2>
<pre><code class="language-mermaid">
flowchart TD

%% Theory
T1[theory/EFC-S / EFC-D / EFC-C / IMX]
T2[theory/architecture.md]
T1 --&gt; T2

%% Source Code
subgraph SRC[src/efc/]
    C1[efc_core.py]
    C2[efc_potential.py]
    C3[efc_entropy.py]
    C4[efc_validation.py]
end
T2 --&gt; SRC

%% Scripts
subgraph SCRIPTS[scripts/]
    S1[run_efc_baseline.py]
    S2[validate_efc.py]
    S3[check_imports.py]
    S4[update_efc_api.py]
end
SRC --&gt; S1
SRC --&gt; S2
SRC --&gt; S3
SRC --&gt; S4

%% Data
subgraph DATA[data/ + external]
    D1[JWST]
    D2[DESI]
    D3[SPARC]
end
DATA --&gt; S2

S2 --&gt; OUT1[output/validation]
S1 --&gt; OUT2[output/baseline]

%% Semantics
subgraph SEM[Semantic Layer]
    SC1[schema/concepts.json]
    SC2[schema/site-graph.json]
    SC3[figshare-index.json]
    SC4[methodology/]
end
SC1 --&gt; S4
S4 --&gt; API[api/v1]

%% Open Science
OUT1 --&gt; FS[Export to Figshare]
OUT2 --&gt; FS
SC1 --&gt; FS
SC3 --&gt; FS
FS --&gt; DOI[Figshare DOIs]

%% Reflection
API --&gt; REF[reflection/]
T1 --&gt; REF
SC2 --&gt; REF
FS --&gt; REF
</code></pre>

<h2>Last Updated</h2>
<p>Automatically tracked by <code>update-readme-date.yml</code>.</p>

</body>
</html>
